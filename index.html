<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refaccionaria Mill√°n - V6 CLEAN</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary: #ffd700; --dark: #111; --light: #eee; --danger: #ff4444; --success: #00cc66; --info: #00d2ff; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background: #f4f4f4; color: #333; padding-bottom: 80px; }
        
        /* HEADER */
        header { background: var(--dark); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .logo-header { font-size: 1.1rem; font-weight: 900; text-transform: uppercase; color: #fff; display: flex; align-items: center; gap: 10px; }
        .logo-header i { color: var(--primary); font-size: 1.5rem; }
        
        nav button { background: none; border: none; color: #aaa; font-size: 1.5rem; margin-left: 20px; cursor: pointer; transition: 0.3s; }
        nav button.active { color: var(--primary); transform: scale(1.2); text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }

        .page { display: none; padding: 15px; max-width: 1000px; margin: 0 auto; }
        .page.active { display: block; }

        /* --- PANTALLA PRINCIPAL (HERO) --- */
        .hero-container { 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            height: 70vh; text-align: center; 
        }
        .big-logo { font-size: 3rem; color: var(--dark); margin-bottom: 10px; }
        .big-logo span { color: var(--primary); }
        .big-icon { font-size: 4rem; color: var(--primary); margin-bottom: 20px; text-shadow: 2px 2px 5px rgba(0,0,0,0.2); }
        
        /* INPUTS DE B√öSQUEDA */
        .search-wrapper { width: 100%; max-width: 500px; position: relative; margin-bottom: 20px; }
        .search-input { 
            width: 100%; padding: 15px 20px; border-radius: 30px; border: 2px solid #ddd; 
            font-size: 1.1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.1); outline: none; transition: 0.3s;
        }
        .search-input:focus { border-color: var(--primary); box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3); }
        
        .search-google-btn {
            background: #fff; color: #4285F4; border: 1px solid #ddd; padding: 12px 20px; 
            border-radius: 30px; font-weight: bold; cursor: pointer; display: flex; 
            align-items: center; gap: 10px; width: 100%; max-width: 500px; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .search-google-btn:hover { background: #f1f1f1; }

        /* RESULTADOS (GRID) */
        .results-area { display: none; margin-top: 20px; }
        .catalog-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
        
        .product-card { background: white; border-radius: 8px; overflow: hidden; border: 1px solid #ddd; display: flex; flex-direction: column; }
        .prod-info { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .prod-title { font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; color: #333; }
        .prod-code { font-size: 0.7rem; color: #666; background: #eee; padding: 2px 5px; border-radius: 4px; width: fit-content; }
        .prod-price { font-size: 1.2rem; font-weight: 900; color: var(--success); text-align: right; margin: 5px 0; }
        .btn-add { background: var(--dark); color: white; border: none; padding: 8px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 5px; }

        /* POS & ADMIN STYLES */
        .btn-main { background: var(--primary); color: var(--dark); border: none; padding: 15px; width: 100%; font-weight: bold; border-radius: 8px; cursor: pointer; text-transform: uppercase; font-size: 1rem; margin-top: 10px; }
        input.admin-input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        .scanner-box { background: #000; border-radius: 10px; padding: 10px; margin-bottom: 20px; text-align: center; display: none; }
        #reader { width: 100%; }
        .cart-total { font-size: 1.5rem; font-weight: bold; text-align: right; margin: 20px 0; color: var(--dark); border-top: 2px solid #333; padding-top: 10px; }
        .ticket-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px dashed #ccc; background: white; }

        /* BOTON FLOTANTE VOLVER */
        #btn-clear-search { display: none; margin: 20px auto; background: #ccc; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; }

        @media print {
            body * { visibility: hidden; }
            #ticket-print-area, #ticket-print-area * { visibility: visible; }
            #ticket-print-area { position: absolute; left: 0; top: 0; width: 100%; }
            header, nav, .btn-main { display: none; }
        }
    </style>
</head>
<body>

<header>
    <div class="logo-header"><i class="fas fa-bolt"></i> MILL√ÅN <span>V6</span></div>
    <nav>
        <button onclick="irA('home')" id="nav-home" class="active"><i class="fas fa-search"></i></button>
        <button onclick="irA('pos')" id="nav-pos"><i class="fas fa-shopping-cart"></i></button>
        <button onclick="irA('admin')" id="nav-admin"><i class="fas fa-cog"></i></button>
    </nav>
</header>

<div id="home" class="page active">
    
    <div id="hero-section" class="hero-container">
        <i class="fas fa-car-battery big-icon"></i>
        <div class="big-logo">REFACCIONARIA <span>MILL√ÅN</span></div>
        <p style="color:#777; margin-bottom:30px;">Sistema de B√∫squeda Inteligente</p>

        <div class="search-wrapper">
            <input type="text" id="local-search" class="search-input" placeholder="üîç Buscar en Inventario..." onkeyup="buscarLocal()">
        </div>

        <div class="search-wrapper">
            <input type="text" id="google-search-input" class="search-input" placeholder="üåé Buscar en Google..." style="border-color:#4285F4; margin-bottom:10px;">
            <button class="search-google-btn" onclick="buscarEnGoogle()">
                <i class="fab fa-google" style="color:#4285F4;"></i> IR A GOOGLE
            </button>
        </div>
    </div>

    <div id="results-section" class="results-area">
        <h3 style="border-bottom: 2px solid var(--primary); padding-bottom:10px;">Resultados en Existencia:</h3>
        <div id="catalog-grid" class="catalog-grid"></div>
        <button id="btn-clear-search" onclick="limpiarBusqueda()">‚¨ÖÔ∏è Nueva B√∫squeda</button>
    </div>

</div>

<div id="pos" class="page">
    <h2><i class="fas fa-cash-register"></i> Caja</h2>
    <button id="btn-cam" class="btn-main" onclick="toggleScanner()" style="background:#333; margin-bottom:15px;">üì∏ ACTIVAR C√ÅMARA</button>
    
    <div id="scanner-area" class="scanner-box">
        <div id="reader"></div>
        <button onclick="toggleScanner()" style="background:red; color:white; border:none; padding:5px; margin-top:5px;">CERRAR</button>
    </div>

    <div id="cart-list" style="background:white; border-radius:5px; min-height:100px; padding:10px;">
        <div style="text-align:center; color:#999; padding:20px;">Carrito Vac√≠o</div>
    </div>
    <div class="cart-total">Total: $<span id="total-amount">0.00</span></div>
    <button class="btn-main" style="background:var(--success); color:white;" onclick="imprimirTicket()">COBRAR</button>
</div>

<div id="admin" class="page">
    <h2>Configuraci√≥n</h2>
    <div style="background:#222; color:white; padding:15px; border-radius:10px;">
        <label>Ganancia Global (%):</label>
        <input type="number" id="global-margin" class="admin-input" value="30" style="background:#444; color:#fff; border:none;">
        <button class="btn-main" style="background:var(--info); color:black;" onclick="actualizarPrecios()">ACTUALIZAR PRECIOS</button>
    </div>
    <br>
    <button class="btn-main" style="background:var(--danger);" onclick="forceReset()">‚ö†Ô∏è RECARGAR INVENTARIO ORIGINAL</button>
    
    <h3>Agregar Manual</h3>
    <input type="text" id="new-code" class="admin-input" placeholder="C√≥digo">
    <input type="text" id="new-name" class="admin-input" placeholder="Nombre">
    <input type="number" id="new-cost" class="admin-input" placeholder="Costo ($)">
    <button class="btn-main" onclick="guardarManual()">GUARDAR</button>
</div>

<div id="ticket-print-area" style="display:none; width:300px; font-family:monospace; padding:10px;">
    <div style="text-align:center;">
        <h3>REFACCIONARIA MILL√ÅN</h3>
        <p>Servicio a Domicilio</p>
        <div style="text-align:left;" id="ticket-date"></div>
    </div>
    <div id="ticket-body" style="margin-top:10px; font-size:0.9rem;"></div>
    <p>---------------------------</p>
    <div style="text-align:right; font-size:1.2rem; font-weight:bold;">TOTAL: $<span id="ticket-total">0.00</span></div>
</div>

<script>
    // DATOS DE TUS FOTOS
    const DB_MASTER = [
        {c:"E7691809", n:"Engrane Marcha Dodge (2)", cost:30}, {c:"E7691810", n:"Engrane Marcha Ford Bosch (1)", cost:30},
        {c:"EM4", n:"Engrane Marcha Nissan (4) y Chevy", cost:29}, {c:"EM5", n:"Engrane Marcha VW Golf Jetta (5)", cost:29},
        {c:"A618114ASS", n:"Armadura Nissan Hitachi PMGR 114", cost:264}, {c:"A011097E", n:"Armadura Nissan Chevy 619130", cost:264},
        {c:"PC10530941", n:"Porta Carbon GM Aveo Usatech", cost:75}, {c:"PC698309", n:"Porta Carbon Mitsubishi Grande", cost:75},
        {c:"PC336246", n:"Porta Carbon Ford Nissan 336 246", cost:69}, {c:"PC336245", n:"Porta Carbon Nissan Chevy Tipo Bosch", cost:69},
        {c:"B55", n:"Modulo Encendido Nissan Tsuru 16V", cost:543}, {c:"BOM-TSURU", n:"Bomba Gasolina Bosch Tsuru III", cost:330},
        {c:"RIH738TP", n:"Regulador Nissan RIH 738 Hitachi", cost:317}, {c:"CP1830M", n:"Cable Plastico 18 (30m)", cost:121},
        {c:"F9004LED", n:"Foco 9004 LED 4 Caras Juego", cost:275}, {c:"HX10", n:"Foco 3157 Hella (Caja 10)", cost:116},
        {c:"H4", n:"Foco H4 Hella", cost:31}, {c:"BM70582", n:"Bulbo Motovent VW Caribe 82/68", cost:98}
    ];

    let INVENTARIO = JSON.parse(localStorage.getItem('millan_db_v6')) || [];
    let MARGEN_ACTUAL = localStorage.getItem('millan_margin') || 30;
    let CARRITO = [];
    let scannerObj = null;

    if(INVENTARIO.length === 0) {
        INVENTARIO = JSON.parse(JSON.stringify(DB_MASTER));
        recalcularPreciosInterno();
        guardarDB();
    }
    document.getElementById('global-margin').value = MARGEN_ACTUAL;

    // --- L√ìGICA DE B√öSQUEDA ---
    function buscarLocal() {
        let input = document.getElementById('local-search').value.toUpperCase();
        let hero = document.getElementById('hero-section');
        let results = document.getElementById('results-section');
        let grid = document.getElementById('catalog-grid');
        
        if(input.length > 1) {
            hero.style.display = 'none'; // Ocultar logo grande
            results.style.display = 'block'; // Mostrar resultados
            document.getElementById('btn-clear-search').style.display = 'block';
            
            grid.innerHTML = "";
            let encontrados = INVENTARIO.filter(p => p.n.toUpperCase().includes(input) || p.c.toUpperCase().includes(input));
            
            if(encontrados.length === 0) {
                grid.innerHTML = "<p>No encontrado en existencia.</p>";
            } else {
                encontrados.forEach(p => {
                    grid.innerHTML += `
                    <div class="product-card">
                        <div class="prod-info">
                            <div class="prod-code">${p.c}</div>
                            <div class="prod-title">${p.n}</div>
                            <div class="prod-price">$${p.price.toFixed(2)}</div>
                            <button class="btn-add" onclick="addCart('${p.c}')">AGREGAR AL TICKET</button>
                        </div>
                    </div>`;
                });
            }
        } else {
            limpiarBusqueda();
        }
    }

    function limpiarBusqueda() {
        document.getElementById('local-search').value = "";
        document.getElementById('hero-section').style.display = 'flex';
        document.getElementById('results-section').style.display = 'none';
    }

    function buscarEnGoogle() {
        let txt = document.getElementById('google-search-input').value;
        if(txt) window.open('https://www.google.com/search?q=refaccion automotriz ' + txt, '_blank');
        else alert("Escribe qu√© buscas en Google");
    }

    // --- FUNCIONES COMUNES ---
    function recalcularPreciosInterno() {
        let factor = 1 + (parseFloat(MARGEN_ACTUAL) / 100);
        INVENTARIO.forEach(p => { if(p.cost) p.price = parseFloat((p.cost * factor).toFixed(2)); });
    }
    function guardarDB() { localStorage.setItem('millan_db_v6', JSON.stringify(INVENTARIO)); localStorage.setItem('millan_margin', MARGEN_ACTUAL); }
    
    function addCart(code) {
        let item = INVENTARIO.find(p => p.c === code);
        CARRITO.push(item);
        alert("Agregado: " + item.n);
        renderCart();
    }
    
    function renderCart() {
        let div = document.getElementById('cart-list');
        let total = 0; div.innerHTML = "";
        CARRITO.forEach((p, idx) => {
            total += p.price;
            div.innerHTML += `<div class="ticket-item"><span>${p.n.substring(0,15)}</span><span>$${p.price.toFixed(2)} <i class="fas fa-times" style="color:red" onclick="remCart(${idx})"></i></span></div>`;
        });
        document.getElementById('total-amount').innerText = total.toFixed(2);
    }
    function remCart(idx) { CARRITO.splice(idx,1); renderCart(); }

    function imprimirTicket() {
        if(CARRITO.length === 0) return alert("Nada");
        let body = document.getElementById('ticket-body');
        document.getElementById('ticket-date').innerText = new Date().toLocaleString();
        body.innerHTML = "";
        CARRITO.forEach(p => { body.innerHTML += `<div style="display:flex; justify-content:space-between;"><span>${p.n.substring(0,20)}</span><span>$${p.price.toFixed(2)}</span></div>`; });
        document.getElementById('ticket-total').innerText = document.getElementById('total-amount').innerText;
        window.print();
        if(confirm("¬øLimpiar?")) { CARRITO=[]; renderCart(); }
    }

    // --- ADMIN ---
    function actualizarPrecios() {
        MARGEN_ACTUAL = parseFloat(document.getElementById('global-margin').value);
        recalcularPreciosInterno();
        guardarDB();
        alert("Actualizado al " + MARGEN_ACTUAL + "%");
    }
    function forceReset() { if(confirm("¬øRestaurar inventario original?")) { localStorage.removeItem('millan_db_v6'); location.reload(); } }
    
    function guardarManual() {
        let c = document.getElementById('new-code').value.toUpperCase();
        let n = document.getElementById('new-name').value.toUpperCase();
        let cost = parseFloat(document.getElementById('new-cost').value);
        if(!c || !n || !cost) return alert("Datos incompletos");
        let factor = 1 + (parseFloat(MARGEN_ACTUAL) / 100);
        let price = parseFloat((cost * factor).toFixed(2));
        INVENTARIO.push({c, n, cost, price});
        guardarDB();
        alert("Guardado");
    }

    // --- ESC√ÅNER ---
    function toggleScanner() {
        let area = document.getElementById('scanner-area');
        if(area.style.display === 'block') { if(scannerObj) scannerObj.clear(); area.style.display = 'none'; } 
        else { area.style.display = 'block'; scannerObj = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 }); scannerObj.render(onScanSuccess); }
    }
    function onScanSuccess(decodedText) {
        let prod = INVENTARIO.find(p => p.c === decodedText);
        if(prod) { addCart(decodedText); alert("Encontrado: " + prod.n); scannerObj.pause(); setTimeout(()=>scannerObj.resume(),1500); }
        else if(confirm("C√≥digo nuevo. ¬øAgregar?")) { scannerObj.clear(); document.getElementById('scanner-area').style.display='none'; irA('admin'); document.getElementById('new-code').value=decodedText; }
    }

    function irA(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById('nav-'+id).classList.add('active');
        if(id !== 'pos' && scannerObj) { scannerObj.clear(); document.getElementById('scanner-area').style.display='none'; }
    }
</script>
</body>
</html>
